# Personal CRM v1 - iPhoneビュー 簡易要件定義書

## 画面構成

### 3タブ構成
- **Home**: 今日のイベント、新着コンタクト、Activity
- **Contacts**: 全コンタクトのリスト表示
- **Settings**: 各種設定

---

## Home画面

### 今日のイベント（誕生日セクション）
- **表示条件**: 今日から1週間以内に誕生日を迎えるコンタクト
- **除外条件**: すでに誕生日メッセージを送信済み（`birthdayMessageSent: true`）のコンタクト
- **表示内容**:
  - アバター/写真
  - 名前 + "さんの誕生日"
  - 年齢（例: "40歳のお誕生日おめでとうございます！"）
  - 会社名・肩書
- **アクション**:
  - カードタップ → コンタクト詳細画面へ遷移
  - 「お祝いを送る」ボタン → 誕生日メッセージモーダル表示（FollowUpModal with messageType="birthday"）

### 新着コンタクト
- **表示条件**: `status: "new"` のコンタクト
- **除外条件**: （現状なし）
- **未実装**: 1週間以内の出会い、もしくは1週間以内にアクションがないコンタクトの判定
- **表示内容**:
  - アバター/写真
  - 名前
  - 肩書
  - 会社名
  - NEWバッジ（未開封タグがある場合）
- **アクション**:
  - カードタップ → コンタクト詳細画面へ遷移（未開封タグを自動削除）
  - **メモボタン**: メモ追加モーダル表示（AddNoteModal）
    - メモ追加後もステータスは変わらず新着コンタクトに残る
  - **お礼の連絡ボタン**: お礼メッセージモーダル表示（FollowUpModal with messageType="thank-you"）
    - 送信済みにすると`status: "active"`に変更され、新着コンタクトから消える
  - **後でボタン**: `status: "archived"`に変更され、新着コンタクトから消える

### Activity
- **表示条件**: TimelineSettings（設定画面で管理）に基づいてフィルタリング
- **表示内容**:
  - ユーザーアイコン（左側）
  - アクションタイプアイコン（アイコン右下に小さく表示）
  - アクション内容（例: "田中太郎さんにメモを追加しました: XXX"）
  - 相対時間（例: "5分前"、"2時間前"、"3日前"）
- **表示件数**: 設定で指定された件数（デフォルト10件）
- **アクション**:
  - アクティビティタップ → ActivityDetailModal表示
    - アクティビティの詳細情報を表示
    - 「コンタクトを見る」ボタン → コンタクト詳細画面へ遷移

---

## Contacts画面

### リスト表示
- **ソート順**:
  1. 新着コンタクト（`status: "new"`）が最上位
  2. 同じステータス内では作成日時（`createdDate`）の降順
- **表示内容**:
  - アバター/写真
  - 名前 + 新着バッジ（新着コンタクトの場合）
  - 肩書
  - 会社名
  - ソース（流入経路）
- **アクション**:
  - タップ → コンタクト詳細画面へ遷移

---

## Settings画面

### 外部連携
- **Prairie Card**: 接続済み（設定を確認ボタン）
- **Slack**: 未接続（連携ボタン）
- **Facebook**: 未接続（連携ボタン）

### 通知設定
- **誕生日通知**: ON/OFFトグル
- **V1で非表示**: フォローアップリマインド、転職通知

### Timeline設定（TimelineSettingsSection）
- **通知してほしい内容を選択**:
  - 誕生日
  - 昇進
  - 結婚
  - 出産
  - 転職
  - 新商品発表
  - その他（カスタム追加可能）
- **Activityの表示件数**: スライダーで調整（5件〜30件）

### その他メニュー
- **AI設定**: （未実装）
- **プライバシー**: （未実装）
- **About**: （未実装）

---

## コンタクト詳細画面（ContactDetailPage）

### ヘッダー
- 戻るボタン（←）
- 編集ボタン → ContactEditModal表示

### プロフィールセクション
- アバター/写真
- 名前
- よみがな
- 肩書
- 会社名
- タグライン（あれば）

### 連絡先情報
- よみがな
- メールアドレス（タップでメーラー起動）
- 電話番号（タップで電話アプリ起動）

### 出会った情報
- 出会った場所（metLocation）
- 詳細（metAt）

### タグ
- コンタクトに紐づくタグを青いバッジで表示

### 組織情報
- 会社・組織名
- 部署名
- 役職・肩書
- 会社住所
- 会社電話
- 会社URL

### SNSアカウント
- LinkedIn, Twitter, Facebook, Instagram等のリンク
- グリッド表示（4カラム）

### 関連記事・URL
- サムネイル画像（未実装、Globe アイコン表示）
- タイトル（モック）
- メタディスクリプション（モック）
- URL

### Timeline（その人の人生の出来事）
- **概念**: コンタクト本人に関する出来事や情報
- **表示内容**:
  - 日付（MM.DD形式）
  - エントリータイプ（linkedin, birthday, promotion, marriage, childbirth, job-change, new-product）
  - 内容
- **視覚的な区別**:
  - 誕生日: ピンク背景
  - その他の出来事: ブルー背景
- **誕生日の自動追加**: コンタクトに誕生日があれば自動的にTimelineに追加
- **読み取り専用**: ユーザーが直接編集することはできない（観察のみ）

### Activity（自分のアクション）
- **概念**: ユーザーがこのコンタクトに対して行ったアクション
- **表示内容**:
  - 日付（MM.DD形式）
  - エントリータイプ（note, follow-up-sent, meeting, contact_created）
  - 内容
- **メモ追加機能**:
  - 「メモを追加」ボタン → テキストエリア表示
  - 入力後「追加」ボタンでActivityに追加
- **メモ展開**:
  - メモをタップ → NoteModal（全文表示）
- **V1で非表示**: Reminder関連のアクティビティは除外

### アクションセクション
- **フォローアップ文章を作成**: FollowUpModal表示
- **この人物を深く掘る**: AI検索実行
  - 実行中: `aiSearchStatus: "processing"`
  - 完了: `aiSearchStatus: "completed"`
  - 通知に結果表示
- **このコンタクトを削除**: 削除確認モーダル表示
  - 確認後、コンタクトをcontactsリストから削除
  - Activityに削除履歴を記録
  - 削除後はHome画面に遷移

---

## モーダル

### FollowUpModal（お礼の連絡 / 誕生日メッセージ）

#### トーン選択画面（初期表示）
- **3つのトーン選択**:
  - カジュアル（親しい友人や同僚向け）
  - ニュートラル（ビジネスシーンで使いやすい）
  - フォーマル（初対面や目上の方向け）
- **自分で書く**: 空白の状態からドラフト作成

#### ドラフト編集画面（トーン選択後）
- **ローディングモーダル**: トーン選択後1.5秒間表示（LLM生成をシミュレート）
- **ドラフト編集**: 生成された文面を自由に編集可能
- **トーンを変更**: トーン選択画面に戻る

#### 送信方法選択
- **コピーボタン**: クリップボードにコピー → Toast表示
- **メールで送るボタン**:
  - 表示条件: `contact.email`が存在する場合
  - タップ → メールクライアント選択モーダル表示
  - 選択 → mailto: URLで既定のメーラーを起動（件名 + 本文を挿入）
- **Messengerで送るボタン**:
  - 表示条件: `contact.social?.facebook`が存在する場合
  - タップ → メッセージをクリップボードにコピー → 確認モーダル表示
  - 「はい、Messengerを開く」→ m.me/username を開く
- **送信済にする**:
  - お礼の連絡: `status: "active"`に変更
  - 誕生日: `birthdayMessageSent: true`に変更
  - Activity記録

#### 未実装
- 送信方法に応じた表示ボタン数の動的変更（現状は全て表示）

### AddNoteModal（メモ追加）
- **入力欄**: テキストエリア
- **キャンセルボタン**: モーダルを閉じる
- **追加ボタン**:
  - メモをコンタクトに紐付け（実装は未完了、Activityには記録）
  - フラッシュメッセージ表示「メモを追加しました」
  - 「メモを見る」アクション → コンタクト詳細画面へ遷移

### ContactEditModal（コンタクト編集）
- **自動保存**: 入力内容は即座に保存（Activity追加なし）
- **AIで深く掘る**: AI検索を実行
  - 通知追加、ステータス更新、フラッシュメッセージ表示
  - 3秒後に完了ステータスに更新
- **閉じる**:
  - 編集元がContactDetailPageの場合 → 詳細画面に戻る
  - 直接開いた場合 → Homeに戻る

### AddModal（コンタクト追加）
- **未実装**: 実際のコンタクト追加機能は未実装
- **モック**: サンプルデータの追加のみ

### NotificationModal（通知一覧）
- **表示内容**:
  - AI検索完了通知
  - その他の通知（未実装）
- **アクション**:
  - 通知タップ → 該当コンタクトの詳細画面へ遷移

### ActivityDetailModal（アクティビティ詳細）
- **表示内容**:
  - コンタクトアバター/写真
  - コンタクト名
  - アクティビティの詳細情報
  - タイムスタンプ
- **アクション**:
  - 「コンタクトを見る」ボタン → コンタクト詳細画面へ遷移
  - 閉じるボタン → モーダルを閉じる

---

## Flash（フラッシュメッセージ）

### 表示タイミング
- メモ追加後
- AI検索開始時
- その他アクション完了時

### 表示内容
- メッセージテキスト
- アクションボタン（オプション）
  - 例: 「メモを見る」→ コンタクト詳細へ遷移

### 表示時間
- デフォルト5秒間
- 閉じるボタンで手動で閉じる

---

## データ構造

### Contact
- **基本情報**: id, name, nameReading, company, title, avatar, photoUrl
- **ステータス**: status（"new" | "active" | "archived"）
- **出会い情報**: metAt, metLocation, source, createdDate
- **連絡先**: email, phone
- **SNS**: social（facebook, linkedin, twitter, instagram, line, note, github）
- **誕生日**: birthday, birthdayMessageSent
- **タグ**: tags[]（例: "未開封", "ビジネス", "営業"など）
- **AI検索**: aiSearchStatus（"idle" | "processing" | "completed" | "failed"）
- **組織情報**: organization
  - name（会社・組織名）
  - department（部署名）
  - jobTitle（役職・肩書）
  - address（会社住所）
  - phone（会社電話）
  - url（会社URL）
- **関連URL**: contentUrls[]
- **その他**: priority, tagline, prairieCardUrl, bio

### Activity
- id, contactId, type, description, timestamp

### Notification
- id, type, contactId, title, message, timestamp, read

### Reminder
- id, contactId, dueDate, type, interval, completed

### TimelineSettings
- notificationTypes: string[] （表示したい通知タイプ）
- activityDisplayCount: number （Activityの表示件数）

---

## 未実装・今後の改善点

### Home画面
- [ ] 新着コンタクトの1週間以内の出会い判定
- [ ] 新着コンタクトの1週間以内のアクション有無判定

### FollowUpModal
- [ ] 送信方法に応じた表示ボタン数の動的変更（現状は全ボタン表示）

### AddNoteModal
- [ ] メモをコンタクトのデータに実際に保存（現状はActivityのみ）

### ContactDetailPage
- [ ] 関連記事のサムネイル画像取得（OGP取得）
- [ ] SNSアイコンの実装（現状はプラットフォーム名のみ）

### AI検索
- [ ] 実際のAI検索APIとの連携（現状は3秒後に完了するモック）

### AddModal
- [ ] 実際のコンタクト追加機能実装（名刺スキャン、手動入力、SNS連携）

### Settings
- [ ] AI設定の実装
- [ ] プライバシー設定の実装
- [ ] About画面の実装
- [ ] 外部連携の実際の認証フロー

### 全般
- [ ] バックエンドAPIとの連携
- [ ] データの永続化（ローカルストレージ or データベース）
- [ ] 検索機能の実装
- [ ] リマインダー機能の実装（V1では非表示）
